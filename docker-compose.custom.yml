# Config override for deployment
version: '3'

services:
  api:
    environment:
    - ASPNETCORE_ENVIRONMENT=Production
    volumes:
    - ./keys:/testkeys:ro
    - ./keys:/keys:ro
    labels:
    - "traefik.enable=true"
    - "traefik.docker.network=web"
    - "traefik.http.routers.wom-registry-api.rule=Host(`wom.social`) && Path(`/api`)"
    - "traefik.http.middlewares.wom-registry-api.stripprefix.prefixes=/api"
    - "traefik.http.middlewares.wom-registry-api.stripprefix.forceslash=false"
    - "traefik.http.routers.wom-landing-api.rule=Host(`wom.social`) && (Path(`/payment`) || Path(`/vouchers`))"
    restart: unless-stopped

  well-known:
    labels:
    - "traefik.enable=true"
    - "traefik.docker.network=web"
    - "traefik.http.routers.wom-well-known.rule=Host(`wom.social`) && Path(`/.well-known`)"
    - "traefik.http.middlewares.wom-well-known.stripprefix.prefixes=/.well-known"
    - "traefik.http.middlewares.wom-well-known.stripprefix.forceslash=false"
    restart: unless-stopped
